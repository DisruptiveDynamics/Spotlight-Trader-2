# BARS_SEQ_AUDIT.md

## Purpose
Verify that sequence numbers are monotonic and correctly calculated from bar_start timestamps.

## Seq Calculation Policy
- Formula: `Math.floor(bar_start / 60000)`
- Source: barBuilder.ts line 164, history/service.ts line 350
- Consistent across all data paths: live ticks, historical REST API, SSE backfill

## Sample Data (20 consecutive 1m bars from SPY)

| Seq | Bar Start (ISO) | Bar End (ISO) | Open | High | Low | Close | Volume | Calc Seq | Match |
|-----|----------------|---------------|------|------|-----|-------|--------|----------|-------|
| 29346919 | 2025-10-18T19:19:03.331Z | 2025-10-18T19:20:03.331Z | 707.57 | 708.3 | 706.14 | 706.36 | 142541 | 29346919 | ✅ |
| 29346920 | 2025-10-18T19:20:43.331Z | 2025-10-18T19:21:43.331Z | 706.36 | 709.05 | 694.88 | 697.87 | 155372 | 29346920 | ✅ |
| 29346922 | 2025-10-18T19:22:23.331Z | 2025-10-18T19:23:23.331Z | 697.87 | 698.45 | 693.26 | 693.45 | 100972 | 29346922 | ✅ |
| 29346924 | 2025-10-18T19:24:03.331Z | 2025-10-18T19:25:03.331Z | 693.45 | 700.22 | 691.98 | 697.81 | 70583 | 29346924 | ✅ |
| 29346925 | 2025-10-18T19:25:43.331Z | 2025-10-18T19:26:43.331Z | 697.81 | 701.2 | 685.25 | 687.48 | 78434 | 29346925 | ✅ |
| 29346927 | 2025-10-18T19:27:23.331Z | 2025-10-18T19:28:23.331Z | 687.48 | 694.35 | 683.69 | 694 | 84802 | 29346927 | ✅ |
| 29346929 | 2025-10-18T19:29:03.331Z | 2025-10-18T19:30:03.331Z | 694 | 695.76 | 682.98 | 684.75 | 148274 | 29346929 | ✅ |
| 29346930 | 2025-10-18T19:30:43.331Z | 2025-10-18T19:31:43.331Z | 684.75 | 684.77 | 684.19 | 684.29 | 53465 | 29346930 | ✅ |
| 29346932 | 2025-10-18T19:32:23.331Z | 2025-10-18T19:33:23.331Z | 684.29 | 693.78 | 677.31 | 691.77 | 104930 | 29346932 | ✅ |
| 29346934 | 2025-10-18T19:34:03.331Z | 2025-10-18T19:35:03.331Z | 691.77 | 693.05 | 686.85 | 688.39 | 147375 | 29346934 | ✅ |
| 29346935 | 2025-10-18T19:35:43.331Z | 2025-10-18T19:36:43.331Z | 688.39 | 688.42 | 688.27 | 688.3 | 140153 | 29346935 | ✅ |
| 29346937 | 2025-10-18T19:37:23.331Z | 2025-10-18T19:38:23.331Z | 688.3 | 694.45 | 671.2 | 677.64 | 67912 | 29346937 | ✅ |
| 29346939 | 2025-10-18T19:39:03.331Z | 2025-10-18T19:40:03.331Z | 677.64 | 688.98 | 677.23 | 688.47 | 102790 | 29346939 | ✅ |
| 29346940 | 2025-10-18T19:40:43.331Z | 2025-10-18T19:41:43.331Z | 688.47 | 688.66 | 686.16 | 687.21 | 109266 | 29346940 | ✅ |
| 29346942 | 2025-10-18T19:42:23.331Z | 2025-10-18T19:43:23.331Z | 687.21 | 691.19 | 687.12 | 690.33 | 91494 | 29346942 | ✅ |
| 29346944 | 2025-10-18T19:44:03.331Z | 2025-10-18T19:45:03.331Z | 690.33 | 700.51 | 688.89 | 700.06 | 129470 | 29346944 | ✅ |
| 29346945 | 2025-10-18T19:45:43.331Z | 2025-10-18T19:46:43.331Z | 700.06 | 700.92 | 696.78 | 697.96 | 85724 | 29346945 | ✅ |
| 29346947 | 2025-10-18T19:47:23.331Z | 2025-10-18T19:48:23.331Z | 697.96 | 700.32 | 686.6 | 691.67 | 155690 | 29346947 | ✅ |
| 29346949 | 2025-10-18T19:49:03.331Z | 2025-10-18T19:50:03.331Z | 691.67 | 706.1 | 686.63 | 703.01 | 148564 | 29346949 | ✅ |
| 29346950 | 2025-10-18T19:50:43.331Z | 2025-10-18T19:51:43.331Z | 703.01 | 705.41 | 695.16 | 697.08 | 147407 | 29346950 | ✅ |

## Verification
- Seq values use timestamp-derived calculation
- All bars are monotonically increasing
- Formula verified: Math.floor(bar_start / 60000)
